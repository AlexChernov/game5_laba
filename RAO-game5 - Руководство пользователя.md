### Руководство пользователя ###
#### Общие сведения ####
Программное обеспечение представляет собой инструментарий для исследования работы механизма точек принятия решений, реализованных в языке интеллектуального моделирования РДО. Плагин, динамически подключаемый к основной программе, расширяет её возможности, позволяя пользователю создать начальную ситуацию для “игры 5” (сокращенные “пятнашки”) и поменять законы алгоритма поиска решения. При этом модель создается автоматически. Цель и правила этой игры такие же, как и в “пятнашках”, а именно - необходимо расставить фишки в определенной последовательности, используя при перемещении только одну свободную ячейку. После моделирования имеется возможность визуально оценить полученный граф пространства состояний задачи, решение, если оно было найдено, и сделать выводы об эффективности заданных законов.
#### Загрузка плагина ####
Для загрузки плагина пятнашек в программный комплекс RAO-studio нужно:

1. Убедиться в наличии файла разделяемой библиотеки в папке plugins. Эта папка должна находиться в том же репозитории, что и исполняемый файл rdo_studio
2. Запустить RAO-studio

   ![Alt text][img01]

   Рис. 1. RAO_studio меню Просмотр
   
3. Из меню `Просмотр` открыть `Настройки`

   ![Alt text][img02]
   
   Рис. 2 .Диалоговое окно настроек
   
4. Во вкладке `Плагины` активировать нужный плагин. Для этого выделить его в списке, нажать кнопку `Запустить`. Закрыть диалоговое окно настроек
5. ~~Создать новую~~ или открыть уже имеющуюся модель
6. В появившемся меню `Плагины` активировать работу плагина

   ![Alt text][img03]

   Рис. 3. Активация плагина пятнашек

После этих действий, пользователь может сразу начать работу с моделью, т.к. вкладка `FUN` создается автоматически, в эту вкладку можно ввести свои эвристики и любые вспомогательные функции. Вкладку `FUN` можно менять в любое время.

![Alt text][img04]

Рис. 4. Вкладка Fun
#### Создание новой игровой ситуации ####
Для создания новой игровой ситуации можно воспользоваться кнопкой `Расставить фишки` на панели инструментов, после чего появится окно настройки начального состояния игрового поля(Рис. 5)

![Alt text][img05]

Рис. 5. Окно настройки начального состояния игрового поля

Пользователю доступны различные способы расстановки фишек:
* Если навести указатель мыши на фишку и нажать на левую кнопку, то фишка переместится на свободную позицию, если такая имеется рядом с ней
* `Перемешать` - случайная расстановка фишек на поле. Следует иметь в виду, что при этом может быть НЕ найдено решение задачи, если не активен флажок `Только решаемые`
* `По порядку` - выстроить все фишки в последовательность, которую они должны иметь в целевой вершине
* `Задать..` -  задание игровой ситуации с клавиатуры в специальном диалоговом окне, при этом номера фишек разделяются пробелами, позиция пустого места отмечается `0`. Например, `1 5 2 4 0 3` - задаст ситуацию, приведенную на рисунке 7

![Alt text][img06]

Рис. 6. Диалоговое окно задания игровой ситуации с клавиатуры

![Alt text][img07]

Рис .7. Результат задания игровой ситуации с клавиатуры

У окна имеются и функциональные кнопки:
* `Ok` - выйти из режима создания ситуации, запомнить текущее расположение фишек (изменить файл ресурсов) и запустить расчет задачи
* `>>` - вывести дополнительное диалоговое окно для изменения файла точек принятия решений (см. Рис. 8).
* Закрытие окна приведет к выходу из режима создания ситуации без запоминания расположения фишек

![Alt text][img08]

Рис. 8. Расширенное окно настройки начального состояния игрового поля

После вызова дополнительного диалогового окна у пользователя появляется возможность изменить содержимое файла точек принятия решений, т.е. изменить законы алгоритма поиска решения на графе пространства состояний. Рассмотрим доступные разделы и команды:
* **Эвристика** - раздел, предназначенный для задания формулы вычисления h(n) - оценки стоимости пути, оставшегося до целевой вершины, проходящего через текущую вершину n. Можно выбрать
  * `0` - поиск в ширину
  * `Кол_во_фишек_не_на_месте(0)` - реализованная в модели функция, которая вычисляет количество фишек, находящихся не на месте
  * `Расстояния_фишек_до_мест(0)` - реализованная в модели функция, которая вычисляет сумму количества ходов каждой фишки, требуемое для достижения конечной позиции
  * Поле ввода - здесь пользователь может задать любую функцию, которую он сам опишет в файле функций
* **Прохождение графа** - раздел, определяющий необходимсоть сравнивать в процессе поиска новые вершины с уже существующими. Если снять флажок `Сравнивать вершину с раскрытыми` возможно зайти в цикл при расчете, т.к. система не будет ‘знать’, что она уже была в этой вершине
* **Стоимость принятия правил** - раздел, определяющий правила построения графа. В нашей модели таких правил четыре - перемещение фишек в различные направления: вправо, влево, вверх и вниз
  * `before` - изменять стоимость пути с помощью указанного далее арифметического выражения до выполнения правила
  * `after` - изменять стоимость пути после выполнения правила
  * `Стоимость` - арифметическое выражение, определяющее стоимость применения этого правила. По умолчанию значение `1`, наличие флажка позваляет его редактировать. В этом разделе пользователь может использовать функции, например `Кол_во_фишек_не_на_месте(0)` или задать свою 

Для большей ясности последнего диалогового окна вспомним синтаксис языка РДО. Нас будет интересовать его часть, посвященная описанию точек принятия решений в ракурсе нашей модели. Описание точки принятия решений имеет следующий формат:
<pre>
<b>$Decision_point</b> &lt;имя точки&gt; : &lt;тип точки&gt; &lt;признак трассировки&gt;
<b>$Condition</b> &lt;условие активизации точки&gt;
<b>$Term_condition</b> &lt;терминальное условие&gt;
<b>$Evaluate_by</b> &lt;оценка стоимости оставшегося пути на графе&gt;
<b>$Compare_tops</b> = (<b>YES</b> | <b>NO</b>)
<b>$Activities</b>
&#9&lt;имя активности> : &lt;имя образца&gt; &lt;значения параметров образца&gt;
&#9&#9(<b>value before</b> | <b>value after</b>) &lt;стоимость применения правила&gt;
&#9{ &lt;имя активности&gt; : &lt;имя образца&gt; &lt;значения параметров образца&gt;
&#9&#9(<b>value before</b> | <b>value after</b>) &lt;стоимость применения правила&gt; }
<b>$End</b>
</pre>

`имя точки` должно быть уникальным, `тип точки` - `search`, т.к. именно этот тип предназначен для поиска на графе. `признак трассировки` - `trace_all`, что позволяет собирать все необходимые показатели о поиске на графе в файле трассировки.

В качестве условия активизации точки указана функция:
<pre><b>Exist</b>(Фишка: Фишка.Номер  &lt; &gt; Фишка.Местоположение),</pre>
которая возвращает значение **ИСТИНА**, если хотя бы одна фишка находится не на месте.

Терминальное условие, которое определяет окончание поиска, задано в виде функции:
<pre><b>For_All</b>(Фишка: Фишка.Номер = Фишка.Местоположение),</pre>
которая возвращает значение **ИСТИНА**, если все фишки находятся на месте.

Эти две функции недоступны пользователю для изменения.

Поле `оценка стоимости оставшегося пути на графе` после ключевого слова `$Evaluate_by` задается значением из раздела **Эвристика**, описанного выше, значение для `$Compare_tops` выбирается на основе раздела **Прохождение графа**, в зависимости от активности флажка `Сравнивать вершину с раскрытыми` или его отсутсвии, `YES` или `NO` соответсвенно.

Раздел активностей заполняется автоматически, но на основе значений из диалогового окна создания начальной ситуации, пользователь может повлиять на поля `(value before | value after)` и `стоимость применения правила`. Значения для этих полей задаются в разделе **Стоимость принятия правил**

Для более подробной информации обратитесь к справочному руководству по РДО или к методичке по поиску.

#### Запуск модели и просмотр результатов ####
Модель запускается автоматически после нажатия `Ok` в окне создания игровой ситуации.
В процессе моделирования RAO-studio подготавливает файл трассировки, в который записывается ход расчета. Файл имеет текстовый формат и описан в документации. Обработка этого файла происходит автоматически после завершения расчета. После удачной обработки трассировки можно построить граф рассчитанного пространства состояний задачи и визуально оценить его и путь решения, если таковой был найден. Окно с графом откроется автоматически, вручную его можно открыть с помощью кнопки на панели инструментов `Построить граф`. Информация о графе отображается в верхнем левом углу окна.

![Alt text][img09]

Рис. 9. Окно графа

Для активизации одной из вершин графа достаточно нажать на неё левой кнопкой мыши. В каждой вершине содержится полная информация о ее состоянии. Чтобы эту информацию вывести в информационное окно, необходимо дважды нажать на левую кнопку мыши над вершиной.

![Alt text][img10]

Рис. 10. Окно информации о вершине

При этом появляется возможность перемещаться по вершинам графа, используя кнопки в нижнем левом углу, что соответственно переместит активную вершину на одну вперед или назад. Решением задачи является путь, как набор правил, которые необходимо применить к исходной вершине, чтобы добраться до целевой. Вершины, лежащие на пути-решении выделены серым цветом.

Для изменения масштаба отображаемого графа предусмотрены команды: 
* **Zoom In** - приблизить на фиксированный шаг `Ctrl + +`
* **Zoom Out** - отдалить на фиксированный шаг `Ctrl + -`
* **Zoom Fit** - вписать граф в окно. Также активирует автоматическое изменение масштаба графа при изменении окна до следующего ручного изменения масштаба. Размеры графа после вписания ограничены максимальным и минимальным масштабами. `Ctrl + 9`
* **Normal Size** - вернуть масштаб 1:1 `Ctrl + 0`

Эти команды доступны в меню масштабирования(см. Рис. 11), которое вызывается по клику правой кнопкой мыши, и горячим клавишам, указанным выше. Прокрутка колесом мыши при нажатой клавише `Shift` также приведет к масштабирвоанию

![Alt text][img11]

Рис. 11. Меню масштабирования

[img01]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img01.png ""
[img02]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img02.png ""
[img03]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img03.png ""
[img04]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img04.png ""
[img05]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img05.png ""
[img06]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img06.png ""
[img07]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img07.png ""
[img08]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img08.png ""
[img09]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img09.png ""
[img10]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img10.png ""
[img11]: https://github.com/AlexChernov/game5_laba/raw/master/img/Img11.png ""
